<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Instructor</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    .modal {
        display: none;
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background-color: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index:1000;
    }
    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }
    .modal-content h3 {
        margin-top:0;
        color:#1f2937;
        font-size: 1.5rem;
        margin-bottom: 10px;
        text-align: center;
    }
    .modal-content p {
        margin: 6px 0;
        color: #374151;
    }
    .modal-content button {
        background-color:#ef4444;
        color:white;
        padding:8px 16px;
        border:none;
        border-radius:4px;
        cursor:pointer;
        margin-top:10px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    .modal-content button:hover {
        background-color:#dc2626;
    }
</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-white shadow-md py-4 px-8 flex justify-between items-center">
    <div class="flex-1 flex justify-center">
        <div class="px-6 py-2 rounded-lg">
            <h2 class="text-2xl md:text-3xl font-extrabold text-center bg-gradient-to-r from-blue-500 to-green-500 bg-clip-text text-transparent drop-shadow-lg uppercase">
                BIENVENIDO INSTRUCTOR {{ instructor.nombre_instructor }} {{ instructor.apellido_instructor }}
            </h2>
        </div>
    </div>
    <div class="flex items-center gap-4">
        <a href="{{ url_for('instructor_bp.notificaciones') }}" class="p-2 text-2xl bg-yellow-200 rounded-lg hover:bg-yellow-300 transition">游댒</a>
        <a href="{{ url_for('auth.logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition">CERRAR SESI칍N</a>
    </div>
</header>

<main class="flex-1 p-8 flex flex-col gap-8">

    <!-- Contenedor principal -->
    <div class="flex flex-col md:flex-row gap-8">

        <!-- Calendario (izquierda) -->
        <div class="bg-white rounded-2xl shadow-xl p-4 w-full md:w-1/3">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 text-center">CALENDARIO</h2>
            <div class="flex justify-between items-center mb-2">
                <div class="flex gap-2">
                    <button id="mesAnterior" class="px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">&lt;</button>
                    <select id="mes" class="border border-gray-300 rounded-lg px-2 py-1 font-semibold focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm">
                        <option value="0">Enero</option><option value="1">Febrero</option><option value="2">Marzo</option>
                        <option value="3">Abril</option><option value="4">Mayo</option><option value="5">Junio</option>
                        <option value="6">Julio</option><option value="7">Agosto</option><option value="8">Septiembre</option>
                        <option value="9">Octubre</option><option value="10">Noviembre</option><option value="11">Diciembre</option>
                    </select>
                    <button id="mesSiguiente" class="px-2 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">&gt;</button>
                </div>
                <div class="flex items-center gap-2">
                    <button id="anioAnterior" class="px-2 py-1 bg-gray-200 rounded-lg hover:bg-gray-300 transition">&lt;</button>
                    <select id="anio" class="border border-gray-300 rounded-lg px-2 py-1 font-semibold focus:outline-none focus:ring-2 focus:ring-green-400 text-sm"></select>
                    <button id="anioSiguiente" class="px-2 py-1 bg-gray-200 rounded-lg hover:bg-gray-300 transition">&gt;</button>
                </div>
            </div>
            <!-- D칤as de la semana -->
            <div class="grid grid-cols-7 text-center text-gray-700 font-semibold border-b border-gray-200 mb-1 text-xs md:text-sm">
                <div>Lun</div><div>Mar</div><div>Mi칠</div><div>Jue</div><div>Vie</div><div class="text-red-500">S치b</div><div class="text-red-500">Dom</div>
            </div>
            <div id="calendario" class="grid grid-cols-7 gap-0 text-center text-xs md:text-sm"></div>
        </div>

        <!-- Botones (derecha) horizontal -->
        <div class="flex flex-col justify-center items-center w-full md:w-2/3">
            <div class="flex gap-8 justify-center w-full">
                <a href="/estudiantes/listarEstudiantes" class="w-36 h-36 bg-blue-300 rounded-xl transform rotate-45 shadow-lg flex items-center justify-center text-gray-800 font-semibold hover:bg-blue-400 transition">
                    <span class="transform -rotate-45 text-center">ESTUDIANTES</span>
                </a>
                <a href="{{ url_for('instructor_bp.perfil_instructor') }}" class="w-36 h-36 bg-green-300 rounded-xl transform rotate-45 shadow-lg flex items-center justify-center text-gray-800 font-semibold hover:bg-green-400 transition">
                    <span class="transform -rotate-45 text-center">PERFIL</span>
                </a>
            </div>
        </div>

    </div>

    <!-- Enviar mensaje (inferior) -->
    <div class="bg-white rounded-2xl shadow-xl p-6 w-full md:w-2/3 mx-auto mt-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ENVIAR MENSAJE</h2>
        <form action="{{ url_for('instructor_bp.enviar_mensaje') }}" method="POST" class="flex flex-col gap-4">
            <label for="rol_destinatario" class="font-semibold text-gray-700">Rol destinatario</label>
            <select name="rol_destinatario" id="rol_destinatario" class="border border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400" required>
                <option value="">Seleccione rol</option>
                <option value="Coordinador">Coordinador</option>
                <option value="Administrador">Administrador</option>
                <option value="Aprendiz">Aprendiz</option>
            </select>

            <label for="destinatario_id" class="font-semibold text-gray-700">Aprendiz destinatario (opcional)</label>
            <select name="destinatario_id" id="destinatario_id" class="border border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400">
                <option value="">Todos los aprendices</option>
                {% for a in aprendices %}
                <option value="{{ a.id_aprendiz }}">Aprendiz: {{ a.nombre }} {{ a.apellido }} - {{ a.ficha }}</option>
                {% endfor %}
            </select>

            <label for="mensaje" class="font-semibold text-gray-700">Mensaje</label>
            <textarea name="mensaje" id="mensaje" rows="4" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Escribe tu mensaje aqu칤..." required></textarea>

            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition">Enviar</button>
        </form>
    </div>

</main>

<!-- Modal -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h3>Detalles del Aprendiz</h3>
        <div id="modal-body"></div>
        <button onclick="cerrarModal()">Cerrar</button>
    </div>
</div>

<footer class="mt-auto h-10">
    <div class="w-full h-full bg-gradient-to-r from-green-300 via-green-400 to-green-500 rounded-t-full"></div>
</footer>

<script>
const calendario = document.getElementById("calendario");
const mesSelect = document.getElementById("mes");
const btnMesAnterior = document.getElementById("mesAnterior");
const btnMesSiguiente = document.getElementById("mesSiguiente");
const modal = document.getElementById("modal");
const modalBody = document.getElementById("modal-body");
const anioSelect = document.getElementById("anio");
const btnAnioAnterior = document.getElementById("anioAnterior");
const btnAnioSiguiente = document.getElementById("anioSiguiente");

const fechaHoy = new Date();
let mesActual = fechaHoy.getMonth();
let a침oActual = fechaHoy.getFullYear();

// Llenar a침os 췀50 a침os alrededor del a침o actual
for(let i=a침oActual-50; i<=a침oActual+50; i++){
    const option = document.createElement("option");
    option.value=i;
    option.textContent=i;
    anioSelect.appendChild(option);
}
anioSelect.value = a침oActual;

// Eventos desde Flask
const eventos = {{ eventos|tojson }};

function generarCalendario(mes) {
    calendario.innerHTML = "";
    const primerDia = new Date(a침oActual, mes, 1).getDay();
    const diasMes = new Date(a침oActual, mes + 1, 0).getDate();
    let inicio = primerDia === 0 ? 6 : primerDia - 1;

    for (let i = 0; i < inicio; i++) {
        const div = document.createElement("div");
        div.className = "p-2 border border-gray-100";
        calendario.appendChild(div);
    }

    for (let d = 1; d <= diasMes; d++) {
        const div = document.createElement("div");
        div.textContent = d;
        div.className = "p-2 border border-gray-200 hover:bg-blue-100 cursor-pointer transition duration-200 ease-in-out flex items-center justify-center font-medium rounded-lg shadow-sm";

        const fechaActualStr = `${a침oActual}-${String(mes + 1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;

        if (mes === fechaHoy.getMonth() && d === fechaHoy.getDate() && a침oActual === fechaHoy.getFullYear()) {
            div.classList.add("bg-blue-500","text-white","font-bold","rounded-full","shadow-lg");
        }

        const pos = inicio + d -1;
        if(pos%7 ===5 || pos%7===6) div.classList.add("text-red-600","font-semibold");

        const eventosDelDia = eventos.filter(e => e.fecha_fin === fechaActualStr);

        if(eventosDelDia.length>0){
            div.classList.add("bg-green-300","text-white","font-bold","rounded-full","shadow-md");
        }

        if(eventosDelDia.length>0){
            div.title = eventosDelDia.map(e=>`Nombre: ${e.nombre}\nFicha: ${e.ficha}\nInicio: ${e.fecha_inicio}\nFin: ${e.fecha_fin}`).join("\n\n");
            div.addEventListener("click",()=> {
                modalBody.innerHTML = eventosDelDia.map(e=>`<p><strong>Nombre:</strong> ${e.nombre}</p>
                <p><strong>Ficha:</strong> ${e.ficha}</p>
                <p><strong>Fecha Inicio:</strong> ${e.fecha_inicio}</p>
                <p><strong>Fecha Fin:</strong> ${e.fecha_fin}</p>`).join("<hr>");
                modal.style.display="flex";
            });
        }

        calendario.appendChild(div);
    }
}

function cerrarModal(){ modal.style.display="none"; }

mesSelect.addEventListener("change",()=>{ mesActual=parseInt(mesSelect.value); generarCalendario(mesActual); });
anioSelect.addEventListener("change",()=>{ a침oActual=parseInt(anioSelect.value); generarCalendario(mesActual); });
btnMesAnterior.addEventListener("click",()=>{ mesActual=(mesActual-1+12)%12; if(mesActual===11)a침oActual--; mesSelect.value=mesActual; anioSelect.value=a침oActual; generarCalendario(mesActual); });
btnMesSiguiente.addEventListener("click",()=>{ mesActual=(mesActual+1)%12; if(mesActual===0)a침oActual++; mesSelect.value=mesActual; anioSelect.value=a침oActual; generarCalendario(mesActual); });
btnAnioAnterior.addEventListener("click",()=>{ a침oActual--; anioSelect.value=a침oActual; generarCalendario(mesActual); });
btnAnioSiguiente.addEventListener("click",()=>{ a침oActual++; anioSelect.value=a침oActual; generarCalendario(mesActual); });

mesSelect.value=mesActual;
generarCalendario(mesActual);

window.addEventListener("click",(event)=>{ if(event.target===modal)cerrarModal(); });
</script>

</body>
</html>
