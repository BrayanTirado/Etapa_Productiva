{% extends "base.html" %}

{% block title %}{% if modo == 'editar' %}Editar Sede{% else %}Crear Sede{% endif %}{% endblock %}

{% block content %}

<div class="bg-white shadow-2xl rounded-3xl p-4 sm:p-10 w-full max-w-lg mx-auto my-10 sm:my-20">
    <h2 class="text-2xl sm:text-4xl font-extrabold text-center text-green-700 mb-8">
        {% if modo == 'editar' %}Editar Sede{% else %}Crear Nueva Sede{% endif %}
    </h2>

    <!-- Mensajes flash generales -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
        {% for category, message in messages %}
          {% if category != 'success_sede' %}
          <div class="px-5 py-3 rounded-lg text-center font-medium text-lg
                      {% if category=='error' %}bg-red-500 text-white
                      {% elif category=='success' %}bg-green-500 text-white
                      {% elif category=='warning' %}bg-yellow-400 text-gray-900
                      {% else %}bg-blue-500 text-white{% endif %}">
            {{ message }}
          </div>
          {% endif %}
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Formulario de creación/edición -->
    <form method="POST" action="{{ url_for('coordinador_bp.crear_sede') }}" class="space-y-6">
        {% if modo != 'editar' %}
        <div>
            <label class="block text-gray-700 font-semibold text-lg mb-2">Token de administrador:</label>
            <input type="text" name="token" required
                   placeholder="Ingresa el token suministrado por el administrador"
                   class="w-full px-5 py-3 border border-gray-300 rounded-xl text-lg focus:ring-2 focus:ring-blue-500 shadow-sm">
        </div>
        {% endif %}

        <!-- Nombre sede con búsqueda -->
        <div>
            <label class="block text-gray-700 font-semibold text-lg mb-2">Nombre de la sede:</label>
            <select name="nombre_sede" id="nombre_sede" required oninput="filtrarOpciones(this)"
                    class="w-full px-5 py-3 border border-gray-300 rounded-xl text-lg focus:ring-2 focus:ring-blue-500 shadow-sm">
                <option value="">Selecciona una sede o escribe para buscar</option>
                {% for option_value, option_text in [
                    ('CGAO', 'CGAO - CENTRO DE GESTIÓN AGROEMPRESARIAL DEL ORIENTE'),
                    ('CCS', 'CCS - CENTRO DE COMERCIO Y SERVICIOS'),
                    ('CDM', 'CDM - CENTRO DE DISEÑO Y METROLOGÍA'),
                    ('CGAF', 'CGAF - CENTRO DE GESTIÓN ADMINISTRATIVA Y FINANCIERA'),
                    ('CGPI', 'CGPI - CENTRO DE GESTIÓN DE LA PRODUCCIÓN INDUSTRIAL'),
                    ('CTIC', 'CTIC - CENTRO DE TECNOLOGÍA DE LA INFORMACIÓN Y COMUNICACIONES'),
                    ('CBA', 'CBA - CENTRO DE BIOTECNOLOGÍA AGROPECUARIA'),
                    ('CEM', 'CEM - CENTRO DE ENERGÍA Y MINAS'),
                    ('CSF', 'CSF - CENTRO DE SERVICIOS FINANCIEROS'),
                    ('CFGR', 'CFGR - CENTRO DE FORMACIÓN EN GESTIÓN DEL RIESGO')
                ] %}
                <option value="{{ option_text }}" {% if modo == 'editar' and sede.nombre_sede == option_text %}selected{% endif %}>
                    {{ option_text }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Ciudad -->
        <div>
            <label class="block text-gray-700 font-semibold text-lg mb-2">Ciudad:</label>
            <input type="text" name="ciudad" required
                   value="{% if modo == 'editar' %}{{ sede.ciudad }}{% endif %}"
                   placeholder="Ej: Bogotá, Medellín, Bucaramanga..."
                   class="w-full px-5 py-3 border border-gray-300 rounded-xl text-lg focus:ring-2 focus:ring-blue-500 shadow-sm">
        </div>

        <!-- Botón -->
        <button type="submit"
                class="w-full bg-green-700 text-white py-3 rounded-xl font-bold text-lg hover:bg-green-400 transition-colors shadow-lg">
            {% if modo == 'editar' %}Actualizar Sede{% else %}Crear Sede{% endif %}
        </button>
    </form>
</div>

<!-- Modal de éxito -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      {% if category == 'success_sede' %}
        <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
          <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6 w-full max-w-md text-center">
            <p class="text-lg font-semibold text-gray-800 mb-4">
              {{ message }}
            </p>
            <a href="{{ url_for('coordinador_bp.dashboard') }}" 
               class="px-4 py-2 bg-sena-primary text-white rounded-lg hover:bg-sena-dark transition">
              OK
            </a>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Script para filtrar opciones mientras se escribe -->
<script>
function filtrarOpciones(select) {
  const input = select.value.toLowerCase();
  for (let i = 0; i < select.options.length; i++) {
    const txt = select.options[i].text.toLowerCase();
    if (txt.includes(input) || select.options[i].value === "") {
      select.options[i].style.display = "";
    } else {
      select.options[i].style.display = "none";
    }
  }
}
</script>

{% endblock %}
